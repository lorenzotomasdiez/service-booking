---
name: Create Comprehensive Makefile with Colored Output
status: open
created: 2025-10-10T11:16:30Z
updated: 2025-10-10T13:33:50Z
github: https://github.com/lorenzotomasdiez/service-booking/issues/3
depends_on: [2]
parallel: false
conflicts_with: []
---

# Task: Create Comprehensive Makefile with Colored Output

## Description

Build a comprehensive Makefile to serve as the unified interface for all Docker operations, replacing scattered npm scripts and complex docker-compose commands. The Makefile must include 30+ commands with rich visual feedback (colored output, progress indicators, helpful error messages) and be cross-platform compatible (macOS, Linux, WSL2).

**Goal**: Developers should only need to remember `make help`, `make up`, `make down`, and `make reset` for 90% of their workflow.

## Acceptance Criteria

- [ ] Makefile created at project root with 30+ commands
- [ ] Cross-platform compatibility (macOS, Linux, WSL2) using `tput` for colors
- [ ] Self-documenting: `make help` shows all commands with descriptions
- [ ] Colored output implemented:
  - GREEN (✓) for success messages
  - RED (✗) for error messages
  - YELLOW (⚠) for warnings
  - BLUE (ℹ) for info messages
  - CYAN (→) for running actions
- [ ] All commands are idempotent (safe to run multiple times)
- [ ] Smart prerequisite checking (Docker running, ports available, etc.)
- [ ] Error messages include suggested solutions
- [ ] `.PHONY` targets declared for all commands
- [ ] Environment variable support (loads from `.env` if exists)
- [ ] Progress indicators for long-running operations
- [ ] Service health status table (`make status`)

**Command Categories** (30+ total):

**Setup & Info** (3 commands):
- [ ] `make help` - Show all commands with descriptions
- [ ] `make version` - Show Docker, docker-compose, service versions
- [ ] `make doctor` - Check system requirements and configuration

**Lifecycle Management** (5 commands):
- [ ] `make up` - Start all services (base + dev + mocks)
- [ ] `make down` - Stop all services gracefully
- [ ] `make restart` - Restart all services
- [ ] `make rebuild` - Rebuild and restart all services
- [ ] `make clean` - Remove all containers, volumes, networks

**Environment Variants** (5 commands):
- [ ] `make dev` - Start development environment only (postgres, redis)
- [ ] `make full` - Start everything (dev + monitoring + mocks)
- [ ] `make monitoring` - Start monitoring stack only
- [ ] `make mocks` - Start Argentina mocks only
- [ ] `make test` - Start test environment

**Database Operations** (6 commands):
- [ ] `make db-migrate` - Run Prisma migrations
- [ ] `make db-seed` - Seed database with test data
- [ ] `make db-reset` - Drop, migrate, seed (complete reset)
- [ ] `make db-backup` - Backup database to file
- [ ] `make db-restore` - Restore database from backup
- [ ] `make db-shell` - Open PostgreSQL shell

**Monitoring & Debugging** (6 commands):
- [ ] `make logs` - Tail logs from all services
- [ ] `make status` - Show health status of all services (table format)
- [ ] `make ps` - List running containers
- [ ] `make stats` - Show resource usage (CPU, memory)
- [ ] `make health` - Run health checks on all services
- [ ] `make logs-backend`, `make logs-frontend` - Service-specific logs

**Maintenance** (4 commands):
- [ ] `make reset` - Complete environment reset (down + clean + up + seed)
- [ ] `make prune` - Remove unused Docker resources
- [ ] `make update` - Pull latest images and rebuild
- [ ] `make validate` - Validate all docker-compose files

**Development Shortcuts** (3+ commands):
- [ ] `make shell-backend` - Open shell in backend container
- [ ] `make shell-frontend` - Open shell in frontend container
- [ ] `make exec` - Execute command in service container

## Technical Details

**Makefile Structure**:
```makefile
# Color definitions using tput for portability
GREEN  := $(shell tput -Txterm setaf 2)
YELLOW := $(shell tput -Txterm setaf 3)
RED    := $(shell tput -Txterm setaf 1)
BLUE   := $(shell tput -Txterm setaf 4)
CYAN   := $(shell tput -Txterm setaf 6)
RESET  := $(shell tput -Txterm sgr0)

# OS detection
UNAME_S := $(shell uname -s)
ifeq ($(UNAME_S),Darwin)
    OPEN := open
endif
ifeq ($(UNAME_S),Linux)
    OPEN := xdg-open
endif

# Load .env if exists
ifneq (,$(wildcard .env))
    include .env
    export
endif

# Default goal
.DEFAULT_GOAL := help

# PHONY targets
.PHONY: help up down restart clean dev full status logs reset

help: ## Show this help message
	@echo '$(CYAN)BarberPro Docker Environment$(RESET)'
	@echo ''
	@echo 'Usage: make [target]'
	@echo ''
	@echo 'Available targets:'
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / \
	    {printf "  $(CYAN)%-20s$(RESET) %s\n", $$1, $$2}' $(MAKEFILE_LIST)
```

**Example Command with Error Handling**:
```makefile
up: check-docker check-ports ## Start all services
	@echo "$(CYAN)[→]$(RESET) Starting BarberPro Development Environment..."
	@echo "$(CYAN)[→]$(RESET) Checking prerequisites..."
	@docker-compose -f docker/docker-compose.yml -f docker/docker-compose.dev.yml -f docker/docker-compose.mocks.yml up -d || \
	    (echo "$(RED)[✗]$(RESET) Failed to start services" && exit 1)
	@echo "$(GREEN)[✓]$(RESET) Services started successfully"
	@$(MAKE) status
	@echo ""
	@echo "$(GREEN)[✓]$(RESET) Environment ready! ✨"
	@echo ""
	@echo "Services running at:"
	@echo "  Frontend:      http://localhost:5173"
	@echo "  Backend API:   http://localhost:3000"
	@echo "  Database UI:   http://localhost:8080"
	@echo ""

check-docker:
	@docker info > /dev/null 2>&1 || \
	    (echo "$(RED)[✗]$(RESET) Docker is not running. Please start Docker Desktop." && exit 1)
	@echo "$(GREEN)[✓]$(RESET) Docker is running"

check-ports:
	@! lsof -ti:5432 > /dev/null 2>&1 || \
	    (echo "$(RED)[✗]$(RESET) Port 5432 is in use. Stop postgres or run 'make dev-external-db'" && exit 1)
	@echo "$(GREEN)[✓]$(RESET) Required ports are available"
```

**Status Table Example**:
```makefile
status: ## Show service health status
	@echo "$(CYAN)Service Status$(RESET)"
	@echo "─────────────────────────────────────────────────────"
	@docker-compose -f docker/docker-compose.yml ps --format "table {{.Name}}\t{{.Status}}\t{{.Ports}}"
```

## Dependencies

- [ ] Task 2 completed (docker-compose files in place)
- [ ] GNU Make installed (should be on all platforms)
- [ ] `tput` available for colors (standard on Unix systems)
- [ ] `lsof` for port checking (or equivalent)
- [ ] Docker and docker-compose commands accessible

## Effort Estimate

- **Size**: M
- **Hours**: 10-14 hours
- **Parallel**: false (depends on Task 2)

**Breakdown**:
- Makefile structure and setup: 2-3 hours
- Lifecycle commands (up, down, restart, etc.): 2-3 hours
- Database commands: 2 hours
- Monitoring/debugging commands: 2 hours
- Color output and error handling: 2 hours
- Testing on multiple platforms: 2-3 hours

## Definition of Done

- [ ] Makefile created with 30+ commands
- [ ] `make help` shows all commands with descriptions
- [ ] All commands produce colored output
- [ ] Error messages include helpful suggestions
- [ ] Tested on macOS and Linux
- [ ] `make up` starts environment < 60 seconds (cold start)
- [ ] `make status` shows health of all services
- [ ] `make reset` completes in < 2 minutes
- [ ] Documentation added to `docker/README.md`
- [ ] Code reviewed
- [ ] Demo video created showing key commands

## Notes

**Cross-Platform Considerations**:
- Use `tput` instead of ANSI escape codes (more portable)
- Test on WSL2 (most common Windows setup for developers)
- Provide fallback if `tput` not available (plain output)
- Document platform-specific quirks in README

**npm Script Integration**:
```json
{
  "scripts": {
    "docker:up": "make up",
    "docker:down": "make down",
    "docker:reset": "make reset",
    "docker:logs": "make logs"
  }
}
```

**Future Enhancements** (out of scope for this task):
- Interactive menu mode
- Docker Compose V2 profiles support
- Automated port conflict resolution
- Performance profiling mode
